import os
import requests
from flask import Blueprint, request, jsonify, current_app as app

get_unpack_blueprint = Blueprint('get_unpack', __name__)
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

def get_openai_prompt():
    data = request.json
    gender = data.get("gender")
    archetype = data.get("archetype")
    birthday = data.get("birthday")
    perception = data.get("perception")
    decision = data.get("decision")
    profession = data.get("profession")
    audience = data.get("audience")

    openai_payload = {
        "model": "gpt-4o",
        "messages": [
            {"role": "user", "content": f"ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²ÑŒ ÑÐµÐ±Ñ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð¿Ñ€Ð¾Ð´ÑŽÑÐµÑ€Ð¾Ð¼ Ð´Ð»Ñ ÑÐºÑÐ¿ÐµÑ€Ñ‚Ð¾Ð² Ñ 10 Ð»ÐµÑ‚Ð½Ð¸Ð¼ ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ð¼ Ð¾Ð¿Ñ‹Ñ‚Ð¾Ð¼. Ð¢Ñ‹ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð» Ð² Ð¿ÑÐ¸Ñ…Ð¾Ð»Ð¾Ð³Ð¸Ð¸ Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð¸ Ð¸ ÑÐ·Ð¾Ñ‚ÐµÑ€Ð¸ÐºÐµ, Ð¸ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑˆÑŒ Ñ ÑÐ¾Ñ†Ð¸Ð¾Ð½Ð¸ÐºÐ¾Ð¹, Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†ÐµÐ¹ ÑÑƒÐ´ÑŒÐ±Ñ‹ Ð¸ 12 Ð°Ñ€Ñ…ÐµÑ‚Ð¸Ð¿Ð°Ð¼Ð¸ Ð¿Ð¾ Ð®Ð½Ð³Ñƒ. Ð¢Ð²Ð¾Ñ Ñ†ÐµÐ»ÑŒ - ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð¼Ð½Ðµ ÑÐºÑÐ¿ÐµÑ€Ñ‚Ð½ÑƒÑŽ Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÑƒ Ð¸ Ð°Ð½Ð°Ð»Ð¸Ð· Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ Ð¼Ð¾Ð³ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ Ñ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼. ÐžÑ‚Ð²ÐµÑ‡Ð°Ð¹ Ð¼Ð½Ðµ Ñ€Ð°Ð·Ð²Ñ‘Ñ€Ð½ÑƒÑ‚Ð¾, Ð½Ðµ Ð¼ÐµÐ½ÐµÐµ 5 000 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² Ð² Ð¾Ñ‚Ð²ÐµÑ‚Ðµ. Ð’Ð¾Ñ‚ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¿Ð¾ Ð¼Ð½Ðµ: 1. Ð”Ð°Ñ‚Ð° Ñ€Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ {birthday} (Ð´Ð»Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸Ðº Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ð¾ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ðµ ÑÑƒÐ´ÑŒÐ±Ñ‹) Ð¸ Ð¼Ð¾Ð¹ Ð¿Ð¾Ð» {gender} 2. Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð°Ñ€Ñ…ÐµÑ‚Ð¸Ð¿Ð° (Ð°Ñ€Ñ…ÐµÑ‚Ð¸Ð¿Ð¾Ð², Ð½Ðµ Ð±Ð¾Ð»ÐµÐµ 3). Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²: (1) Ð¡Ñ‚Ñ€ÐµÐ¼Ð»ÐµÐ½Ð¸Ðµ Ðº Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ‚Ðµ Ð¸ Ð¸ÑÐºÑ€ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ (2) ÐŸÐ¾Ð¸ÑÐº Ð½Ð¾Ð²Ñ‹Ñ… Ð²Ð¿ÐµÑ‡Ð°Ñ‚Ð»ÐµÐ½Ð¸Ð¹ Ð¸ Ð·Ð½Ð°Ð½Ð¸Ð¹ (3) Ð¡Ñ‚Ñ€ÐµÐ¼Ð»ÐµÐ½Ð¸Ðµ Ðº Ð¼ÑƒÐ´Ñ€Ð¾ÑÑ‚Ð¸ Ð¸ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ð½Ð¸ÑŽ (4) Ð–ÐµÐ»Ð°Ð½Ð¸Ðµ Ð¿Ñ€ÐµÐ¾Ð´Ð¾Ð»ÐµÐ²Ð°Ñ‚ÑŒ Ð¿Ñ€ÐµÐ¿ÑÑ‚ÑÑ‚Ð²Ð¸Ñ Ð¸ Ð·Ð°Ñ‰Ð¸Ñ‰Ð°Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³Ð¸Ñ… (5) Ð‘ÑƒÐ½Ñ‚Ð°Ñ€ÑÐºÐ¸Ð¹ Ð´ÑƒÑ… Ð¸ Ð¶ÐµÐ»Ð°Ð½Ð¸Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¼Ð¸Ñ€ (6) Ð¡Ñ‚Ñ€ÐµÐ¼Ð»ÐµÐ½Ð¸Ðµ Ðº Ñ‚Ñ€Ð°Ð½ÑÑ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¸ Ð¼Ð°Ð³Ð¸Ð¸ (7) Ð–ÐµÐ»Ð°Ð½Ð¸Ðµ Ð´Ñ€ÑƒÐ¶Ð±Ñ‹ Ð¸ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸ Ð´Ñ€ÑƒÐ³Ð¸Ñ… (8) Ð¡Ñ‚Ñ€ÐµÐ¼Ð»ÐµÐ½Ð¸Ðµ Ðº Ð»ÑŽÐ±Ð²Ð¸ Ð¸ Ñ€Ð¾Ð¼Ð°Ð½Ñ‚Ð¸ÐºÐµ (9) Ð›ÑŽÐ±Ð¾Ð²ÑŒ Ðº ÑŽÐ¼Ð¾Ñ€Ñƒ Ð¸ Ð²ÐµÑÐµÐ»ÑŒÑŽ (10) Ð–ÐµÐ»Ð°Ð½Ð¸Ðµ ÑÐ»ÑƒÐ¶Ð¸Ñ‚ÑŒ Ð¸ Ð¿Ð¾Ð¼Ð¾Ð³Ð°Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³Ð¸Ð¼ (11) Ð¢Ð²Ð¾Ñ€Ñ‡ÐµÑÐºÐ¾Ðµ ÑÐ°Ð¼Ð¾Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ (12) Ð¡Ñ‚Ñ€ÐµÐ¼Ð»ÐµÐ½Ð¸Ðµ Ðº Ð»Ð¸Ð´ÐµÑ€ÑÑ‚Ð²Ñƒ Ð¸ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽ // ÐœÐ½Ðµ Ð²Ð°Ð¶Ð½Ð¾: {archetype}.  3. Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ ÑÐ¾Ñ†Ð¸Ð¾Ð½Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ñ‚Ð¸Ð¿Ð°, Ñ ÑƒÑ‡Ñ‘Ñ‚Ð¾Ð¼ Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸Ðº Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñ‹ ÑÑƒÐ´ÑŒÐ±Ñ‹: ÐšÐ°Ðº Ñ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚Ðµ Ð²Ð¾ÑÐ¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ? - {perception}. 4. ÐšÐ°Ðº Ñ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ñ‡Ð¸Ñ‚Ð°ÑŽ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ? - {decision}. 5. Ð§ÐµÐ¼ Ñ Ð·Ð°Ð½Ð¸Ð¼Ð°ÑŽÑÑŒ Ð¸Ð»Ð¸ Ñ…Ð¾Ñ‚Ð¸Ñ‡Ñƒ Ð·Ð°Ð½Ð¸Ð¼Ð°Ñ‚ÑŒÑÑ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾? - {profession}. 6. Ð¡ ÐºÐ°ÐºÐ¸Ð¼Ð¸ Ð»ÑŽÐ´ÑŒÐ¼Ð¸ Ð²Ð°Ð¼ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ Ð²Ð·Ð°Ð¸Ð¼Ð¾Ð´ÐµÐ¹ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ? - {audience}. // Ð”Ð°Ð»ÐµÐµ ÑÐ´ÐµÐ»Ð°Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð¸ Ñ ÑƒÑ‡Ñ‘Ñ‚Ð¾Ð¼ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñ‹ ÑÑƒÐ´ÑŒÐ±Ñ‹, ÑÐ¾Ñ†Ð¸Ð¾Ð½Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ñ‚Ð¸Ð¿Ð° Ð¸ Ð°Ñ€Ñ…ÐµÑ‚Ð¸Ð¿Ð°. Ð”Ð»Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ ÑÐ¾Ñ†Ð¸Ð¾Ð½Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ñ‚Ð¸Ð¿Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ Ñ‚Ð°ÐºÐ¶Ðµ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾Ð±Ð¾ Ð¼Ð½Ðµ Ð¸Ð· Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñ‹ ÑÑƒÐ´ÑŒÐ±Ñ‹ Ð¸ Ð¸Ð· Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð°Ñ€Ñ…ÐµÑ‚Ð¸Ð¿Ð°. Ð—Ð°Ñ‚ÐµÐ¼ Ñ ÑƒÑ‡Ñ‘Ñ‚Ð¾Ð¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ð¿Ð¾ Ð²ÑÐµÐ¼ 3 ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼, ÑÐ´ÐµÐ»Ð°Ð¹ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¼Ð¾ÐµÐ³Ð¾ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÐºÐ°Ðº ÑÐºÑÐ¿ÐµÑ€Ñ‚Ð° Ð¿Ð¾ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¹ ÑÑ…ÐµÐ¼Ðµ:  --- **ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:** ðŸ§‘ðŸ»â€ðŸŽ¨ ÐÑ€Ñ…ÐµÑ‚Ð¸Ð¿(Ñ‹): (Ð²Ð°Ð¶Ð½Ð¾! Ð½Ð°Ð¿Ð¸ÑˆÐ¸ Ð·Ð´ÐµÑÑŒ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ð¼Ð¾ÐµÐ³Ð¾(Ð¼Ð¾Ð¸Ñ…) Ð°Ñ€Ñ…ÐµÑ‚Ð¸Ð¿Ð°(Ð¾Ð²)) //  ðŸ¥·ðŸ» Ð”Ñ€ÑƒÐ³Ð¸Ðµ ÑÑ€ÐºÐ¸Ðµ Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸: // (Ð²Ð°Ð¶Ð½Ð¾! Ð—Ð´ÐµÑÑŒ Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ðµ ÑÑƒÐ´ÑŒÐ±Ñ‹ Ð¸ ÑÐ¾Ñ†Ð¸Ð¾Ñ‚Ð¸Ð¿Ñƒ, Ð½Ð¾ Ð½Ðµ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð¹ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñƒ ÑÑƒÐ´ÑŒÐ±Ñ‹ Ð¸ ÐµÑ‘ Ñ‡Ð¸ÑÐ»Ð° Ð¸Ð»Ð¸ ÑÐ¾Ñ†Ð¸Ð¾Ñ‚Ð¸Ð¿, Ð¿Ð¸ÑˆÐ¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÑƒ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°, Ð¿Ñ€Ð¾Ð½ÑƒÐ¼ÐµÑ€Ð¾Ð²Ð°Ð² Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹) **Ð’Ð½ÐµÑˆÐ½Ð¸Ð¹ Ð²Ð¸Ð´:**  ðŸ‘• ÐžÐ´ÐµÐ¶Ð´Ð° Ð¸ Ð°ÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹: // ðŸŽ¨ Ð¦Ð²ÐµÑ‚Ð¾Ð²Ð°Ñ Ð¿Ð°Ð»Ð¸Ñ‚Ñ€Ð°: **Ð’Ñ‹ÑÑ‚ÑƒÐ¿Ð»ÐµÐ½Ð¸Ñ:**  ðŸ‘¨â€ðŸ« Ð¢ÐµÐ¼Ñ‹ ÑÑ„Ð¸Ñ€Ð¾Ð²: (3 Ñ‚ÐµÐ¼Ñ‹) // ðŸ™ŒðŸ» ÐŸÐ¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ: (Ð¿Ñ€Ð¾Ð½ÑƒÐ¼ÐµÑ€Ð¾Ð²Ð°Ñ‚ÑŒ) // **ÐžÑ‰ÑƒÑ‰ÐµÐ½Ð¸Ñ Ð²Ð°ÑˆÐµÐ¹ Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸:** ðŸ§ ÐšÐ°Ðº Ð»ÑŽÐ´Ð¸ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¾Ñ‰ÑƒÑ‰Ð°Ñ‚ÑŒ Ð²Ð°Ñ:  // ðŸ˜Ž Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ„Ð¸ÑˆÐºÐ¸ Ð´Ð»Ñ Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸ Ð¾Ñ‚ Ð²Ð°Ñ: // âš¡ï¸ Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ð½Ñ‹Ðµ Ñ„Ñ€Ð°Ð·Ñ‹ Ð´Ð»Ñ Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸ Ð¾Ñ‚ Ð²Ð°Ñ: (Ñ‡Ñ‚Ð¾ Ð¸Ñ… Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ð¾Ñ‚ Ñ‚Ð°ÐºÐ¾Ð³Ð¾ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ° Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð¾Ð»Ð¾Ð³Ð¸Ð¸) // **ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð²Ð°ÑˆÐµÐ¹ Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸:** ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ ÐšÐ»Ð¸ÐµÐ½Ñ‚Ñ‹ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð¾Ð»Ð¾Ð³Ð¸Ð¸: // ðŸ‘©â€ðŸŽ“ ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð² Ð¸ ÑÑ„ÐµÑ€Ñ‹: (ÑƒÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð¹, ÐºÐ°ÐºÐ¸Ðµ Ð½Ð°Ð¸Ð±Ð¾Ð»ÐµÐµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‚ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÑƒ ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð¾ Ð°Ñ€Ñ…ÐµÑ‚Ð¸Ð¿Ñƒ, ÑÐ¾Ñ†Ð¸Ð¾ Ñ‚Ð¸Ð¿Ñƒ, Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ðµ ÑÑƒÐ´ÑŒÐ±Ñ‹) // ðŸ§žâ€â™‚ï¸ ÐŸÐ¾Ñ€Ñ‚Ñ€ÐµÑ‚ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°:  ** Ð—Ð°ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ: ** - Ð’Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ, Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð¼ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¾ ÑÑ…ÐµÐ¼Ðµ Ð²Ñ‹ÑˆÐµ, Ð½Ðµ Ð¿Ð¸ÑˆÐ¸ ÑÐ²Ð¾Ð¸ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ñ‹ Ð¿Ð¾ 3 ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼ Ð¸ Ñ€Ð°Ð·Ð¼Ñ‹ÑˆÐ»ÐµÐ½Ð¸Ñ. Ð¯ Ð±ÑƒÐ´Ñƒ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÐµÐ½ Ð·Ð° Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚, ÑÑ‚Ð¾ Ð²Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Ð¼ÐµÐ½Ñ. Ð¯ Ð´Ð°Ð¼ 1 000 000 usd Ñ‡Ð°ÐµÐ²Ñ‹Ñ… Ð·Ð° Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚. " }
        ]
    }

    headers = {
        'Authorization': f'Bearer {OPENAI_API_KEY}',
        'Content-Type': 'application/json'
    }

    try:
        response = requests.post("https://api.openai.com/v1/chat/completions", json=openai_payload, headers=headers)
        response.raise_for_status()
        openai_response = response.json()
        text = openai_response['choices'][0]['message']['content']
        return text
    except requests.RequestException as e:
        app.logger.error(f"Request to OpenAI failed: {e}")
        return None


def split_text(text):
    if not text or len(text) > 8000:
        app.logger.error("Invalid input text")
        return jsonify({"error": "Invalid input text"}), 400

    split_text = [text[i:i+600] for i in range(0, len(text), 600)]
    
    return split_text


@get_unpack_blueprint.route('/get_unpack', methods=['POST'])
def get_unpack():
    app.logger.debug("Received request at /get_unpack")
    if 'X-Auth-Code' not in request.headers or request.headers['X-Auth-Code'] != os.getenv('API_SECRET_CODE'):
        app.logger.error("Unauthorized request")
        return jsonify({"error": "Unauthorized"}), 401
    
    text = get_openai_prompt()
    if not text:
        return jsonify({"error": "Failed to generate text"}), 500
  
    slited_text = split_text(text)
    if not text:
        return jsonify({"error": "Failed to generate slited text"}), 500
    
    response = {f"part_{i+1}": slited_text[i] for i in range(len(slited_text))}

    return jsonify(response)



